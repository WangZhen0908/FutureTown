package com.vvage.futuretown.base;

import android.app.Activity;
import android.content.Context;
import android.graphics.Color;
import android.os.Bundle;
import android.support.v4.view.ViewPager.LayoutParams;
import android.util.TypedValue;
import android.view.Gravity;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
import android.widget.TextView;

import com.vvage.futuretown.Global;
import com.vvage.futuretown.R;

/*
 * 页面抽象类 继承Activity
 * 
 */
public abstract class BaseView extends Activity{
	
//	public static final int CUSTOM = 0;
//	public static final int FUTURE_SYSTEM=1;
	
	private int TITLE_HEIGHT;
	private final int TEXT_PANDDING = 8;
	protected TitleParams mTitleParams;
	
	private LinearLayout mTitleLayout;
	private LinearLayout mContainerLayout;
	private LinearLayout mLayout;
	
	/*
	 * 页面子类content view
	 * @param Context
	 * @return View 返回子类内容页面布局
	 */
	protected abstract View creatView(Context context);
	
	protected abstract void onClickLeft();
	protected abstract void onClickRight();
	
	protected void setTitleParams(TitleParams tp){
		mTitleParams = tp;
	}
	
	protected View creatTitle(){
		RelativeLayout layout = new RelativeLayout(getApplicationContext());
		RelativeLayout.LayoutParams lps = new RelativeLayout.LayoutParams(LayoutParams.FILL_PARENT, TITLE_HEIGHT);
		layout.setLayoutParams(lps);
		layout.setBackgroundResource(R.drawable.bg_titleview);
		
		RelativeLayout.LayoutParams leftLayoutLPS = new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);
		leftLayoutLPS.addRule(RelativeLayout.ALIGN_PARENT_LEFT, RelativeLayout.TRUE);
		leftLayoutLPS.addRule(RelativeLayout.CENTER_VERTICAL, RelativeLayout.TRUE);
		leftLayoutLPS.leftMargin = TITLE_HEIGHT/4;
		
		final ButtonTextView left = new ButtonTextView(this);
		left.setLayoutParams(leftLayoutLPS);
		left.setText(mTitleParams==null?"":mTitleParams.left);
		left.setVisibility(mTitleParams==null?LinearLayout.GONE:mTitleParams.isleftVisible);
		left.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View arg0) {
				// TODO Auto-generated method stub
				if(mTitleParams!=null && mTitleParams.isleftVisible==LinearLayout.VISIBLE){
					BaseView.this.onClickLeft();
					if(mTitleParams.isleftVisible != LinearLayout.VISIBLE){
						left.setVisibility(mTitleParams.isleftVisible);
					}
				}
			}
		});
		
		
		RelativeLayout.LayoutParams rightLayoutLPS = new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);
		rightLayoutLPS.alignWithParent = true;
		rightLayoutLPS.addRule(RelativeLayout.ALIGN_PARENT_RIGHT, RelativeLayout.TRUE);
		rightLayoutLPS.addRule(RelativeLayout.CENTER_VERTICAL, RelativeLayout.TRUE);
		rightLayoutLPS.rightMargin = TITLE_HEIGHT/4;
		
		final ButtonTextView right = new ButtonTextView(this);
		right.setLayoutParams(rightLayoutLPS);
		right.setText(mTitleParams==null?"":mTitleParams.right);
		right.setVisibility(mTitleParams==null?LinearLayout.GONE:mTitleParams.isrightVisible);
		right.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View arg0) {
				// TODO Auto-generated method stub
				if(mTitleParams==null){
					
				}else if(mTitleParams!=null && mTitleParams.isrightVisible==LinearLayout.VISIBLE){
					BaseView.this.onClickRight();
					if(mTitleParams.isrightVisible != LinearLayout.VISIBLE){
						right.setVisibility(mTitleParams.isrightVisible);
					}
				}
			}
		});
		
		
		RelativeLayout.LayoutParams titleLPS = new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);
		titleLPS.addRule(RelativeLayout.CENTER_IN_PARENT);
		
		TextView title = new TextView(this);
		title.setGravity(Gravity.CENTER);
		title.setLayoutParams(titleLPS);
		title.setPadding(TEXT_PANDDING,TEXT_PANDDING,TEXT_PANDDING,TEXT_PANDDING);
		title.setSingleLine(true);
		title.setTextColor(Color.WHITE);
		title.setVisibility(mTitleParams==null?LinearLayout.GONE:LinearLayout.VISIBLE);
		title.setText(mTitleParams==null?"":mTitleParams.title);
		title.setTextSize(TypedValue.COMPLEX_UNIT_SP, Global.TEXT_SIZE_LV1);
		
		layout.addView(left);
		layout.addView(title);
		layout.addView(right);
		
		return layout;
	}
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		// TODO Auto-generated method stub
//		The conversion of dp units to screen pixels is simple: px = dp * (dpi / 160).
		TITLE_HEIGHT = Global.dip2px(getApplicationContext(), 50);
		super.onCreate(savedInstanceState);
		
		mLayout = new LinearLayout(getApplicationContext());
		LinearLayout.LayoutParams lps = new LinearLayout.LayoutParams(LayoutParams.FILL_PARENT, LayoutParams.FILL_PARENT);
		mLayout.setLayoutParams(lps);
		mLayout.setOrientation(LinearLayout.VERTICAL);
		
		mTitleLayout = new LinearLayout(getApplicationContext());
		mTitleLayout.setLayoutParams(new LinearLayout.LayoutParams(LayoutParams.FILL_PARENT, TITLE_HEIGHT));
		
		mContainerLayout = new LinearLayout(getApplicationContext());
		mContainerLayout.setLayoutParams(new LinearLayout.LayoutParams(LayoutParams.FILL_PARENT, LayoutParams.FILL_PARENT));
		
		mTitleLayout.addView(creatTitle());
		mContainerLayout.addView(creatView(this));
		
		mLayout.addView(mTitleLayout);
		mLayout.addView(mContainerLayout);
		
		setContentView(mLayout);
	}
	@Override
	protected void onDestroy() {
		// TODO Auto-generated method stub
		super.onDestroy();
	}
	@Override
	protected void onPause() {
		// TODO Auto-generated method stub
		super.onPause();
	}
	@Override
	protected void onRestart() {
		// TODO Auto-generated method stub
		super.onRestart();
	}
	@Override
	protected void onResume() {
		// TODO Auto-generated method stub
		super.onResume();
	}
	
	protected class TitleParams {
//		public boolean defaultParams=false;
		public String left;
		public int isleftVisible;
		
		public String title;
		
		public String right;
		public int isrightVisible;
		
		public TitleParams(String leftText, int isLeftVisible, 
				String title, String rightText, int isrightVisible){
			this.left = leftText;
			this.isleftVisible = isLeftVisible;
			this.title = title;
			this.right = rightText;
			this.isrightVisible = isrightVisible;
		}

	}
	
	private class ButtonTextView extends TextView{
		public ButtonTextView(Context context){
			super(context);
			configurationTextView(context);
		}
		private void configurationTextView(Context context){
			setGravity(Gravity.CENTER);
			setPadding(TEXT_PANDDING*2,TEXT_PANDDING,TEXT_PANDDING*2,TEXT_PANDDING);
			setBackgroundDrawable(Global.newSelectorFromRes(getApplicationContext(), R.drawable.bg_btn_pressed, R.drawable.bg_btn_normal, R.drawable.bg_btn_normal, R.drawable.bg_btn_pressed));
			setSingleLine(true);
			setTextColor(Color.WHITE);
			setTextSize(TypedValue.COMPLEX_UNIT_SP, Global.TEXT_SIZE_LV4);
		}
	}
	
}
