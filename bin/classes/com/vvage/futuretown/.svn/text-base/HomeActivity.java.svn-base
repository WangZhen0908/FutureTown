package com.vvage.futuretown;

import java.util.ArrayList;
import java.util.HashMap;

import android.content.Intent;
import android.os.Bundle;
import android.support.v4.app.FragmentActivity;
import android.view.LayoutInflater;
import android.view.View;
import android.view.Window;
import android.view.animation.Animation;
import android.view.animation.Animation.AnimationListener;
import android.view.animation.AnimationUtils;
import android.widget.LinearLayout;
import android.widget.TabHost;
import android.widget.TabHost.OnTabChangeListener;
import android.widget.Toast;

import com.vvage.futuretown.activity.LoginListener;
import com.vvage.futuretown.fragment.UserFragment;

public class HomeActivity extends FragmentActivity {

	public static TabHost tabHost;
//	private HashMap<String, LoginListener> listener;
	public static ArrayList<HashMap<String, LoginListener>> loginListeners;
	private LinearLayout layout;
	private Animation animation;
//	private View mContentView;
	
	// private View layout;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		
		setContentView(R.layout.activity_home);
		layout = (LinearLayout)findViewById(R.id.id_welcome);
		animation = AnimationUtils.loadAnimation(this, R.anim.push_out);
		layout.startAnimation(animation);
		animation.setAnimationListener(new AnimationListener() {
			@Override
			public void onAnimationStart(Animation animation) {
				// TODO Auto-generated method stub
			}
			
			@Override
			public void onAnimationRepeat(Animation animation) {
				// TODO Auto-generated method stub
			}
			
			@Override
			public void onAnimationEnd(Animation animation) {
				// TODO Auto-generated method stub
				layout.setVisibility(LinearLayout.GONE);
				tabHost.setVisibility(TabHost.VISIBLE);
			}
		});
		
		
		tabHost = (TabHost)findViewById(android.R.id.tabhost);
		tabHost.setup();

		final LayoutInflater mInflater = LayoutInflater.from(this);
		final View homeView = mInflater.inflate(R.layout.tab_home, null);
		final View messageView = mInflater.inflate(R.layout.tab_message, null);
		final View favorView = mInflater.inflate(R.layout.tab_favor, null);
		final View bonusView = mInflater.inflate(R.layout.tab_bonus, null);
		final View userView = mInflater.inflate(R.layout.tab_user, null);

		TabHost.TabSpec user = tabHost.newTabSpec("user").setIndicator(userView)
				.setContent(R.id.tab_user);
		
		tabHost.addTab(tabHost.newTabSpec("home").setIndicator(homeView)
				.setContent(R.id.tab_home));
		tabHost.addTab(tabHost.newTabSpec("message").setIndicator(messageView)
				.setContent(R.id.tab_message));
		tabHost.addTab(tabHost.newTabSpec("favor").setIndicator(favorView)
				.setContent(R.id.tab_favor));
		tabHost.addTab(tabHost.newTabSpec("bonus").setIndicator(bonusView)
				.setContent(R.id.tab_bonus));
		tabHost.addTab(user);

		Global.initResource(getApplicationContext());

		tabHost.setOnTabChangedListener(new OnTabChangeListener() {
			@Override
			public void onTabChanged(String tabId) {
				// TODO Auto-generated method stub
				// tabHost.clearAllTabs();
				if (HomeActivity.loginListeners != null) {
					int size = HomeActivity.loginListeners.size();
					for(int i=0; i<size;++i){
						HashMap<String, LoginListener> hm = HomeActivity.loginListeners.get(i);
						if(hm.containsKey(tabId)){
							hm.get(tabId).Login(UserFragment.isLogin);
						}
					}
				}
			}
		});
		
//		setContentView(mContentView);

	}
	
	public static void setLoginListener(HashMap<String, LoginListener> fmListener){
		if (loginListeners == null) {
			loginListeners = new ArrayList<HashMap<String, LoginListener>>();
		}
		if (!loginListeners.contains(fmListener)) {
			loginListeners.add(fmListener);
		}
	}
	

	@Override
	protected void onActivityResult(int arg0, int arg1, Intent arg2) {
		// TODO Auto-generated method stub
		super.onActivityResult(arg0, arg1, arg2);
	}

	@Override
	protected void onDestroy() {
		// TODO Auto-generated method stub
		super.onDestroy();
	}

	@Override
	protected void onPause() {
		// TODO Auto-generated method stub
		super.onPause();
	}

	@Override
	protected void onResume() {
		// TODO Auto-generated method stub
		super.onResume();
	}

	@Override
	protected void onResumeFragments() {
		// TODO Auto-generated method stub
		super.onResumeFragments();
	}

	@Override
	protected void onSaveInstanceState(Bundle outState) {
		// TODO Auto-generated method stub
		super.onSaveInstanceState(outState);
	}

	@Override
	protected void onStart() {
		// TODO Auto-generated method stub
		super.onStart();
	}

	@Override
	protected void onStop() {
		// TODO Auto-generated method stub
		super.onStop();
	}

	@Override
	protected void onPostResume() {
		// TODO Auto-generated method stub
		super.onPostResume();
	}

}
